# 商品 360 看板测试文档

## 一、测试目的

本次测试旨在验证商品 360 看板中分层（ods->dim->dwd->dws->ads）与不分层两种数据实现方式的一致性，确保两种方式计算得出的关键指标结果相同，保障看板数据的准确性和可靠性，为商家基于看板数据进行决策提供有效支撑。

## 二、测试范围

本次测试覆盖商品 360 看板中的核心业务指标，主要包括：

1. 总销量：衡量商品销售的总量。

2. 总营收：反映商品销售的总收入。

3. 访客数（UV）：统计访问商品的独立用户数量。

测试将针对全量数据、按商品筛选数据以及按日期范围筛选数据三种场景进行验证。

## 三、测试环境

1. 编程语言：Python 3.x

2. 相关库：pandas、numpy、sqlite3、unittest

3. 数据库：SQLite（用于存储测试数据）

## 四、测试数据

### （一）数据生成

通过generate_test_data()函数生成模拟的各层数据表数据，具体如下：

1. **ODS 层数据**：包括销售原始数据（ods_sales）、流量原始数据（ods_traffic）、用户行为原始数据（ods_user_behavior），涵盖订单时间、商品 ID、销售数量、单价、订单金额、访客 ID、访问时间等字段。

2. **DIM 层数据**：商品 SKU 维度表（dim_product_sku），包含商品 ID、SKU ID、商品名称、所属类目等信息。

3. **DWD 层数据**：SKU 销售明细表（dwd_sku_sales），由 ODS 层销售原始数据按订单时间、商品 ID、SKU ID 聚合生成。

4. **DWS 层数据**：销售汇总表（dws_sales_summary），基于 DWD 层数据按日期、商品 ID 汇总得到，包含总销量、总营收等指标。

5. **ADS 层数据**：商品核心概览表（ads_product_core），直接复制 DWS 层销售汇总表数据。

### （二）数据特点

- 数据涵盖 30 天的日期范围，通过随机函数生成，确保一定的随机性和覆盖性。

- 商品 ID、SKU ID、用户 ID、访客 ID 等均采用固定格式的标识，便于区分和关联。

- 订单金额通过销售数量与单价计算得出，保证数据的业务逻辑性。

## 五、测试用例设计

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|测试编号|测试指标|测试场景|分层计算方式|不分层计算方式|预期结果|
|TC-001|总销量|全量数据|从dws_sales_summary表汇总总销量|从ods_sales表汇总销售数量|两种方式计算结果一致|
|TC-002|总销量|按商品筛选|从dws_sales_summary表按指定商品 ID 汇总总销量|从ods_sales表按指定商品 ID 汇总销售数量|两种方式计算结果一致|
|TC-003|总销量|按日期范围筛选|从dws_sales_summary表按指定日期范围汇总总销量|从ods_sales表按指定日期范围汇总销售数量|两种方式计算结果一致|
|TC-004|总营收|全量数据|从dws_sales_summary表汇总总营收|从ods_sales表汇总订单金额|两种方式计算结果一致|
|TC-005|总营收|按商品筛选|从dws_sales_summary表按指定商品 ID 汇总总营收|从ods_sales表按指定商品 ID 汇总订单金额|两种方式计算结果一致|
|TC-006|访客数|全量数据|从ods_traffic表统计 distinct 访客 ID（商品 ID 非空）|从ods_traffic表统计 distinct 访客 ID（商品 ID 非空）|两种方式计算结果一致|
|TC-007|访客数|按商品筛选|从ods_traffic表按指定商品 ID 统计 distinct 访客 ID|从ods_traffic表按指定商品 ID 统计 distinct 访客 ID|两种方式计算结果一致|

## 六、测试执行过程

1. **测试数据准备**：运行generate_test_data()函数生成测试数据，通过create_test_database()函数创建 SQLite 数据库并将测试数据写入数据库表中。

2. **测试环境初始化**：在setUpClass方法中完成测试数据和数据库的准备工作，获取日期范围和商品列表。

3. **执行测试用例**：通过unittest框架运行各个测试方法，分别对不同指标在不同场景下进行测试。

4. **结果校验**：在每个测试方法中，分别调用分层和不分层的计算函数，获取结果并进行断言校验，判断两者是否一致。

## 七、测试结果

### （一）测试汇总

- 测试用例总数：7 个

- 通过用例数：7 个

- 失败用例数：0 个

- 错误用例数：0 个

### （二）详细结果

所有测试用例均通过校验，分层与不分层两种实现方式计算得出的总销量、总营收、访客数等指标在全量数据、按商品筛选、按日期范围筛选等场景下结果均一致。

## 八、测试结论

本次测试验证了商品 360 看板中分层与不分层两种数据实现方式的一致性。测试结果表明，两种方式计算得出的关键指标结果完全相同，说明数据处理逻辑正确，分层架构设计合理，能够满足看板对数据准确性的要求。

基于此，商品 360 看板的分层和不分层两种实现方式均可可靠使用，商家可根据实际业务场景和数据量大小选择合适的方式。