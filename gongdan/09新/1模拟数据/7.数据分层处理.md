ODS 原始表层- DIM 维度表层- DWD 明细数据层- DWS 汇总数据层- ADS应用数据层

**9.3 数据分层处理（ODS - DIM - DWD - DWS - ADS）详解​**
在电商数仓项目的流量主题店内路径看板构建中，数据分层处理是确保数据质量、提升数据处理效率和支撑业务分析的关键环节。从 ODS 层到 ADS 层，每一层都有其特定的功能和处理方式，层层递进，共同构成完整的数据处理链路。​

**一、ODS 层（操作数据存储层​)**

（一）核心目标​

ODS 层作为数据进入数仓的第一站，主要目标是存储原始、未经加工的用户行为及页面访问明细数据，为后续各层处理提供基础数据源。​

（二）数据处理​

1. 数据采集：收集电商平台产生的所有用户行为日志，包括访客 ID、访问时间、页面名称、页面类型、来源页面、去向页面、停留时长、终端类型、是否下单、下单买家 ID 等核心字段。​

2. 数据存储：将采集到的原始数据直接存储，不进行过多处理，保持数据的原始性和完整性。同时，需确保数据量大于 100 万条，以满足后续分析和模型构建的需求。​

3. 性能优化：针对大量数据，采用合理的存储方式和数据压缩技术，提高数据存储和读取效率。​

**二、DIM 层（维度表层）​**

（一）核心目标​

构建业务维度表，规范关键维度定义与编码，为数据分析提供统一基准，实现数据的标准化和一致性。​

（二）数据处理​

1. 维度表设计：根据业务需求，设计页面维度表（dim_page）、时间维度表（dim_time）、设备维度表（dim_device）等。​

2. 字段定义：​

- 页面维度表（dim_page）：包含页面 ID、页面类型（店铺页 / 商品详情页 / 店铺其他页）、页面细分类型（首页 / 活动页 / 订阅页等）、页面名称等字段，对页面相关信息进行规范定义。​

- 时间维度表（dim_time）：涵盖时间 ID、时间粒度（日 / 7 天 / 30 天 / 月）、日期编码、具体日期等，为时间维度的分析提供支持。​

- 设备维度表（dim_device）：包括设备 ID、终端类型（无线 / PC）、设备标识等，明确设备相关信息。​

3. 维度关联：确保各维度表的编码唯一且规范，为后续与事实表的关联做好准备。​

**三、DWD 层（明细数据层）​**

（一）核心目标​

对 ODS 层数据进行清洗、转换与关联，生成结构化的明细事实数据，保留最细粒度的用户行为信息，为后续的汇总分析提供高质量的明细数据。​

（二）数据处理​

1. 数据清洗：过滤 ODS 层中的无效数据，如空访客 ID、异常访问时间等，确保数据的准确性。​

2. 数据转换：将原始数据中的字段进行标准化处理，如将页面类型转换为维度表中定义的编码等。​

3. 数据关联：将清洗转换后的 ODS 层数据与 DIM 层的各维度表进行关联，生成用户页面访问明细事实表（dwd_user_page_visit_detail）。该表包含访客 ID、访问时间 ID（关联 dim_time）、页面 ID（关联 dim_page）、页面类型、来源页面 ID、去向页面 ID、停留时长、设备 ID（关联 dim_device）、是否下单（1/0）、下单买家 ID（若下单）等字段。​

**四、DWS 层（汇总数据层）​**

（一）核心目标​

基于 DWD 层明细数据，按业务需求进行多维度汇总，生成中层汇总指标，减少后续 ADS 层的计算量，提高数据查询和分析效率。​

（二）数据处理​

1. 指标聚合：根据不同的业务场景和分析需求，对 DWD 层数据进行聚合计算。​

- 页面访问指标汇总表（dws_page_visit_stats）：按时间粒度、页面类型、设备类型等维度，汇总访客数、浏览量、平均停留时长、下单买家数等指标。​

- 店内路径流转汇总表（dws_instore_path_flow_stats）：以时间粒度、设备类型、来源页面 ID、去向页面 ID 为维度，汇总访客数，反映页面之间的流转情况。​

- PC 端流量入口汇总表（dws_pc_traffic_entry_stats）：按时间粒度，汇总 PC 端各来源页面的访客数和来源占比。​

2. 预聚合优化：在 DWS 层构建预聚合表（如 dws_page_daily_agg），按日 / 终端类型 / 页面类型提前聚合基础指标，减少 ADS 层计算的数据量。​

**五、ADS 层（应用数据层）​**

（一）核心目标​

基于 DWS 层汇总数据，生成直接支撑 “店内路径看板” 展示的指标数据，满足商家路径分析需求，实现数据到业务应用的最后一步转换。​

（二）数据处理​

1. 数据筛选与整合：从 DWS 层汇总数据中，筛选出与店内路径看板展示相关的数据，进行整合处理。​

2. 生成应用表：​

- 无线端入店与承接指标表（ads_wireless_entry_receive）：包含时间维度、进店页面类型、访客数、下单买家数等字段，用于展示无线端的入店及承接情况。​

- 页面访问排行表（ads_page_visit_rank）：按时间维度、设备类型、页面类型、页面名称等，展示访客数、浏览量、平均停留时长等，并按访客数或浏览量排序，用于页面访问排行展示。​

  以下是 `ads_page_visit_rank` 表中各字段的含义解释，结合电商页面访问分析场景：
### 1. 基础关联与维度字段

|字段名|含义说明|
|---|---|
|`visit_time_id`|访问时间维度编码（关联 `dim_time` 表），用于定位具体分析的时间周期（如日、周）|
|`page_type`|页面类型（如 “商品详情页”“店铺页”），对页面进行业务归类，便于同类对比|
|`device_type`|终端类型（如 “无线端”“PC 端”），区分用户访问设备，分析不同终端的页面偏好|
|`time_dimension`|时间粒度描述（如 “日”“周”“月”），标记数据统计的时间周期类型|
|`page_name`|页面名称（如 “商品详情 A”“分类页”），具体指向某一页面的访问数据|

### 2. 核心指标字段

|字段名|含义说明|
|---|---|
|`visitor_count`|访客数，访问该页面的独立用户数量，反映页面的用户覆盖广度|
|`view_count`|浏览量（PV），页面被访问的总次数，反映页面的曝光热度|
|`avg_stay_duration`|平均停留时长（秒），用户在页面的平均停留时间，体现页面内容的吸引力|
|`purchase_buyer_count`|下单买家数，访问页面后完成下单的用户数量，反映页面的转化能力|

### 3. 排序与分析字段

|字段名|含义说明|
|---|---|
|`rank`|页面访问排行（按访客数 / 浏览量等指标排序后的名次），直接输出页面热度优先级|
- 店内路径流转分析表（ads_instore_path_display）：涵盖时间维度、设备类型、页面名称、来源页面名称、来源访客数、去向页面名称、去向访客数、来源占比、去向占比等，支撑店内路径展示。​
  `ads_instore_path_display` 表的核心字段名称如下，涵盖分析所需的全部维度和指标：



|字段名称|说明|
|---|---|
|`stat_date`|统计日期（如 2025-08-01），用于时间维度分析|
|`terminal_type`|终端类型（如 “无线端”“PC 端”），区分不同设备的用户路径|
|`current_page`|当前页面名称（如 “商品详情 A”“分类页”），为路径分析的核心节点|
|`source_page`|来源页面名称（如 “首页”“搜索引擎 A”），表示用户访问当前页之前的页面|
|`target_page`|去向页面名称（如 “下单页”“商品详情 B”），表示用户离开当前页后的页面|
|`visitor_count`|访客数，即从 “来源页→当前页→去向页” 完整路径的独立用户数量|
|`source_ratio`|来源占比（%），计算公式：（当前来源页的访客数 / 当前页总访客数）× 100|
|`target_ratio`|去向占比（%），计算公式：（当前去向页的访客数 / 当前页总访客数）× 100|



这些字段覆盖了路径分析的核心维度（时间、终端、页面流转）和指标（访客数、占比），可直接支撑 “还原轨迹、定位高转化 / 流失路径” 的分析目标。

![](blob:https://www.doubao.com/fe7a10b5-f8c5-4130-ab10-eb9a43e85039)

这是一张数据库表结构设计的截图，展示了表中各字段的实体信息：



- **字段名称**：`visit_time_id`、`device_type`、`source_page_id`、`dest_page_id`、`visitor_count`、`time_dimension`、`source_page_name`、`dest_page_name`、`source_total`、`source_ratio`
- **对应类型**：`bigint`、`text`、`double` 等，部分字段有长度（如 `bigint` 长度 20 ）、是否非空（`time_dimension` 设为非空 ）等设置 ，可用于构建店内路径流转分析相关的数据表，存储页面访问、设备、时间维度、来源去向等信息 ，为路径分析场景提供数据支撑。

解释各个字段名称

以下是 `ads_instore_path_display` 相关字段的含义解释，结合电商店内路径分析场景：

### 基础关联字段

|字段名|含义说明|
|---|---|
|`visit_time_id`|访问时间维度编码（关联时间维度表 `dim_time` ），用于定位具体分析时间周期|
|`device_type`|终端类型（如 “无线端”“PC 端” ），区分用户访问设备，分析路径的终端差异|
|`source_page_id`|来源页面的唯一编码（关联页面维度表 `dim_page` ），标准化标识用户从哪个页面进入|
|`dest_page_id`|去向页面的唯一编码（关联页面维度表 `dim_page` ），标准化标识用户离开后访问的页面|

### 统计与指标字段

|字段名|含义说明|
|---|---|
|`visitor_count`|该路径下的独立访客数（从 “来源页→当前页→去向页” 完整流转的用户数量）|
|`time_dimension`|时间粒度描述（如 “日”“周”“月” ），标记数据统计的时间周期类型|
|`source_page_name`|来源页面的名称（如 “首页”“搜索引擎推广页” ），用于业务侧直观识别页面|
|`dest_page_name`|去向页面的名称（如 “下单页”“活动页” ），用于业务侧直观识别页面|
|`source_total`|来源页面的总访客基数（当前页面所有来源的访客总和，用于计算占比的分母）|
|`source_ratio`|来源占比（`visitor_count / source_total` ），反映该来源页对当前页流量的贡献度|
- PC 端流量入口 TOP20 表（ads_pc_entry_top20）：包含时间维度、来源页面、访客数、来源占比等，取前 20 名，用于 PC 端流量入口展示。​

3. 存储优化：ADS 层表按 stat_date（统计日期）和 store_id（店铺 ID）分区，对 time_period、terminal_type、page_type 建立联合索引，提升多维度查询效率，确保看板数据的快速展示。​

通过以上从 ODS 层到 ADS 层的分层处理，实现了数据的逐步净化、标准化、聚合和应用化，为流量主题店内路径看板提供了高质量、高效率的数据支撑，使电商商家能够清晰、准确地了解消费者的进店路径和店内流转情况，为业务决策提供有力依据。​

### 一、设计模板与工单的匹配性

1. **核心目标一致**：工单中明确电商商家希望了解消费者的进店路径和店内流转情况，以规划店铺产品、提升购物体验，设计模板围绕流量主题店内路径看板构建数据体系，目标与之契合。
2. **数据范围覆盖**：工单要求包含无线端和 PC 端数据，设计模板的数据分层设计及核心字段涵盖了这两个终端的相关信息，如无线端的访客数、下单买家数，PC 端的来源页面 TOP20 等。
3. **指标与功能对应**：工单提及的页面访问排行、店内路径展示、多维度查询等要求，在设计模板中均有对应的指标实现方案和数据分层设计支撑，例如页面访问排行按访客数或浏览量排序，店内路径展示考虑了页面间不查重等特性。
4. **验收标准满足**：设计模板包含了 ADS 层表设计、原始数据分析、性能优化方案等，符合工单中对设计文档的验收要求。

### 二、测试文档与工单的匹配性

1. **测试范围契合**：工单涉及数据链路（从 ODS 层到 ADS 层）、核心功能（各终端数据展示、指标计算等）、数据特性（页面不重复性、多向性）等，测试文档的测试范围覆盖了这些方面，如数据分层处理测试、核心指标计算测试等。
2. **验证要点对应**：工单要求验证分层与不分层数据一致性、代码注释包含工单编号等，测试文档中设计了相应的测试用例和验证 SQL，且测试依据包含工单编号，符合要求。
3. **产出物关联**：工单明确产出物包括设计文档、代码、测试文档等，测试文档作为产出物之一，其内容围绕看板功能和数据准确性展开，与工单要求一致。



综上，设计模板和测试文档在核心目标、数据范围、功能指标、验收标准等方面均与工单内容相符，符合题意。