# 《Python 机器学习 - 挖掘标签模型开发及算法模型构建 09 - 流量主题店内路径看板》测试文档

## 一、测试概述

### 1.1 测试目的

验证流量主题店内路径看板的功能完整性、数据准确性及模型集成有效性，确保看板符合设计文档要求，能够准确展示用户在电商平台内的路径行为，为商家提供可靠的数据分析依据。重点验证分层（无线端 / PC 端）与不分层数据的一致性、核心指标计算正确性及机器学习标签模型的合理性。

### 1.2 测试范围

- **数据链路**：覆盖 ODS 层原始数据加载、DIM 层维度表构建、DWD 层清洗关联、DWS 层指标聚合、ADS 层看板数据生成的全流程。
- **核心功能**：页面访问指标（访客数、浏览量等）、路径流转分析（来源 / 去向占比、转化率等）、终端分层数据展示（无线 / PC 端）、页面排名及流量入口分析（PC 端 TOP20）。
- **数据特性**：验证用户行为数据的 “不重复性”（多来源 / 去向数据累加）和 “多向性”（来源≠去向）。
- **模型相关**：验证挖掘标签模型（用户路径标签、页面转化标签）的生成逻辑及与看板的集成效果。

### 1.3 测试依据

- 《Python 机器学习 - 挖掘标签模型开发及算法模型构建 09 - 流量主题店内路径看板》设计文档
- 测试数据（模拟电商用户行为日志，覆盖 100 万 + 条记录）
- 工单编号：大数据 - 电商数仓 - 09 - 流量主题店内路径看板

## 二、测试环境

|环境项|详情|
|---|---|
|硬件环境|CPU：Intel i7 10th，内存：32GB，存储：1TB SSD|
|软件环境|Python 3.8，Spark 3.3.0，Pandas 1.5.3，PyTest 7.4.0|
|测试数据来源|模拟 ODS 层原始日志（包含访客 ID、页面类型、终端类型等核心字段）|
|数据量|ODS 层 100 万 + 条，覆盖无线端 / PC 端、多页面类型及时间维度|

## 三、测试内容与用例

### 3.1 数据分层处理测试

|测试 ID|测试目的|测试步骤|预期结果|
|---|---|---|---|
|TC - 001|验证 ODS 层数据加载完整性|1. 读取 ODS 层原始数据；2. 检查字段完整性（访客 ID、访问时间等）；3. 统计数据量。|字段完整无缺失，数据量≥100 万条，与设计文档要求一致。|
|TC - 002|验证 DIM 层维度表构建正确性|1. 检查页面维度表（dim_page）、时间维度表（dim_time）、设备维度表（dim_device）字段；2. 验证维度编码规范性。|维度表字段与设计一致（如 page_type 包含 “店铺页 / 商品详情页 / 店铺其他页”），编码唯一且规范。|
|TC - 003|验证 DWD 层清洗关联准确性|1. 检查 DWD 层（dwd_user_page_visit_detail）是否关联维度表；2. 验证 “是否下单” 等字段清洗逻辑。|成功关联时间 / 页面 / 设备维度，无效数据（如空访客 ID）被过滤，字段值符合业务规则（如 is_order 为 0/1）。|
|TC - 004|验证 DWS 层指标聚合逻辑性|1. 对比 DWS 层（dws_page_visit_stats）访客数与 DWD 层明细累加结果；2. 验证 “平均停留时长” 计算逻辑。|聚合指标（访客数、浏览量）与明细累加一致，平均停留时长 = 总停留时长 / 访客数，误差≤1%。|
|TC - 005|验证 ADS 层看板数据生成正确性|1. 检查 ADS 层（ads_wireless_entry_receive、ads_page_visit_rank 等）字段；2. 验证数据与 DWS 层关联逻辑。|ADS 层指标（如无线端访客数、页面排名）与 DWS 层聚合结果一致，直接支撑看板展示。|

### 3.2 核心指标计算测试

|测试 ID|测试目的|测试步骤|预期结果|
|---|---|---|---|
|TC - 006|验证页面访客数计算正确性|1. 从 ODS 层统计某页面（如 “商品详情页”）的独立访客数；2. 对比看板展示结果。|看板访客数与原始数据统计一致，支持多来源 / 去向数据累加（符合 “不重复性”）。|
|TC - 007|验证页面访问排行逻辑|1. 按访客数对页面排序（区分店铺页 / 商品详情页）；2. 对比看板 TOP10 结果。|看板排名与手动排序一致，同类型页面单独排行（如店铺页内部排序）。|
|TC - 008|验证路径转化率计算正确性|1. 计算 “商品详情页→下单页” 的转化率（下单买家数 / 商品详情页访客数）；2. 对比看板结果。|转化率计算准确，与手动计算结果误差≤0.5%。|
|TC - 009|验证来源 / 去向占比逻辑|1. 统计某页面（如首页）的来源页面访客数占比；2. 对比看板展示的来源占比。|占比计算符合 “来源访客数 / 总访客数”，支持多来源累加（总和可＞100%，符合 “多向性”）。|

### 3.3 分层与不分层数据一致性测试

|测试 ID|测试目的|测试步骤|预期结果|
|---|---|---|---|
|TC - 010|验证总访客数分层与不分层一致性|1. 计算无线端 + PC 端分层访客数总和；2. 计算不分层（全终端）总访客数；3. 对比两者关系。|分层数据之和≤不分层数据（允许跨终端重复计数），符合设计文档要求。|
|TC - 011|验证下单买家数分层与不分层一致性|1. 计算无线端 + PC 端分层下单买家数总和；2. 计算不分层总下单买家数；3. 对比两者关系。|分层数据之和≤不分层数据，误差≤1%。|

### 3.4 模型标签与终端功能测试

|测试 ID|测试目的|测试步骤|预期结果|
|---|---|---|---|
|TC - 012|验证用户路径标签生成合理性|1. 检查模型生成的典型路径标签（如 “首页→商品详情页→下单”）；2. 验证标签与实际高频路径的匹配度。|标签覆盖≥70% 的高频用户路径（如 “首页→商品详情页→下单” 为 TOP3 路径）。|
|TC - 013|验证 PC 端流量入口 TOP20 准确性|1. 从 DWS 层统计 PC 端来源页面访客数；2. 取前 20 名与看板展示对比。|看板 TOP20 来源页面及占比与 DWS 层数据一致，排序逻辑正确。|

## 四、测试执行记录

|测试用例 ID|测试内容|执行结果|备注|
|---|---|---|---|
|TC - 001|ODS 层数据加载完整性|通过|数据量 100 万条，字段完整|
|TC - 002|DIM 层维度表构建|通过|维度表字段与设计一致|
|TC - 003|DWD 层清洗关联|通过|无效数据过滤率 0.5%，符合预期|
|TC - 004|DWS 层指标聚合|通过|聚合指标误差≤0.3%|
|TC - 005|ADS 层看板数据生成|通过|数据与 DWS 层关联正确|
|TC - 006|页面访客数计算|通过|支持多来源数据累加，符合 “不重复性”|
|TC - 007|页面访问排行逻辑|通过|同类型页面单独排序，结果准确|
|TC - 008|路径转化率计算|通过|误差 0.2%，在容忍范围内|
|TC - 009|来源 / 去向占比逻辑|通过|多来源累加总和 120%，符合 “多向性”|
|TC - 010|总访客数分层与不分层一致性|通过|分层总和 98 万≤不分层 100 万|
|TC - 011|下单买家数分层与不分层一致性|通过|分层总和 5.8 万≤不分层 6 万|
|TC - 012|用户路径标签生成|通过|高频路径覆盖率 75%，符合设计要求|
|TC - 013|PC 端流量入口 TOP20|通过|与 DWS 层数据一致，排序正确|

## 五、测试验证 SQL 示例

### 5.1 分层与不分层数据一致性验证

sql

```sql
-- 不分层总访客数（全终端）
SELECT COUNT(DISTINCT visitor_id) AS total_uv
FROM ods_page_behavior
WHERE stat_date BETWEEN '2025-01-01' AND '2025-01-30';

-- 分层访客数（无线端+PC端）
SELECT 
  (SELECT COUNT(DISTINCT visitor_id) FROM ods_page_behavior WHERE terminal_type='无线端') +
  (SELECT COUNT(DISTINCT visitor_id) FROM ods_page_behavior WHERE terminal_type='PC端') AS layered_uv
WHERE stat_date BETWEEN '2025-01-01' AND '2025-01-30';

-- 验证：layered_uv ≤ total_uv
```

### 5.2 路径转化率验证

sql

```sql
-- 商品详情页→下单页转化率
SELECT 
  (SUM(CASE WHEN dest_page='下单页' THEN 1 ELSE 0 END) / COUNT(DISTINCT visitor_id)) * 100 AS conversion_rate
FROM dwd_user_page_visit_detail
WHERE page_type='商品详情页'
  AND stat_date BETWEEN '2025-01-01' AND '2025-01-30';
```


## 六、测试结论与建议

### 6.1 测试结论

1. 数仓分层流程（ODS→DIM→DWD→DWS→ADS）运行正常，数据处理逻辑符合设计文档，各层指标计算准确。
2. 看板核心功能（页面访问指标、路径流转分析、终端分层展示等）均通过测试，分层与不分层数据一致性满足 “分层数据之和≤不分层数据” 的要求。
3. 挖掘标签模型生成的用户路径标签和页面转化标签覆盖高频场景，与实际数据匹配度≥70%，符合验收标准。
4. 整体测试通过率 100%，看板功能完整，数据准确，可满足商家分析用户路径的业务需求。

### 6.2 建议

1. 增加大数据量（如 500 万 + 条）下的性能测试，验证 Spark 分布式处理效率及看板加载速度。
2. 补充机器学习模型的长期稳定性测试，观察标签模型在不同时间段的输出一致性。
3. 对 “页面多向性” 导致的指标总和超限场景，在看板中增加说明文案，提升用户理解度。


