# 电商客服专属优惠业务库表设计文档（完整版）

## 一、文档说明

### 1.1 文档目的

本文档基于电商客服专属优惠场景的代码实现，系统梳理数仓全链路库表结构，明确各表的字段定义、业务含义、数据类型及层级关系，为数据开发、业务分析、系统维护提供统一的库表设计规范和参考依据。

### 1.2 业务范围

覆盖客服专属优惠活动的全生命周期数据，包括活动创建、商品关联、优惠发送、用户核销等核心业务环节，以及基于 RFM 模型的用户分层、活动效果分析、客服绩效评估等数据分析场景。

### 1.3 数仓分层定义

- **ODS 层**（操作数据存储层）：存储原始业务数据，保留数据原貌，不做清洗转换；
- **DIM 层**（维度层）：构建标准化维度表，统一业务编码和描述，支撑多维度分析；
- **DWD 层**（明细数据层）：对 ODS 层数据进行清洗、转换和补全，生成明细事实表；
- **DWS 层**（汇总数据层）：按业务主题汇总明细数据，生成中间指标，支撑上层应用；
- **ADS 层**（应用数据层）：基于 DWS 层数据计算业务指标，直接服务于业务决策。

## 二、库表设计总览

|分层|表名|核心业务场景|
|---|---|---|
|ODS 层|ods_customer_service_promo_activity|客服优惠活动基础信息存储|
|ODS 层|ods_customer_service_promo_activity_item|活动与商品 / SKU 关联关系存储|
|ODS 层|ods_customer_service_promo_send|优惠发送记录存储|
|ODS 层|ods_customer_service_promo_use|优惠核销记录存储|
|ODS 层|ods_customer_service|客服基础信息存储|
|ODS 层|ods_product|商品基础信息存储|
|ODS 层|ods_sku|商品 SKU 信息存储|
|DIM 层|dim_activity_type|活动类型维度标准化|
|DIM 层|dim_customer_service|客服维度标准化|
|DIM 层|dim_product|商品维度标准化|
|DIM 层|dim_sku|SKU 维度标准化|
|DIM 层|dim_shop|店铺维度标准化|
|DWD 层|dwd_customer_service_promo_activity|活动明细事实表（清洗后）|
|DWD 层|dwd_customer_service_promo_send|优惠发送明细事实表（清洗后）|
|DWD 层|dwd_customer_service_promo_use|优惠核销明细事实表（清洗后）|
|DWS 层|dws_customer_rfm|用户 RFM 指标汇总表|
|DWS 层|dws_customer_service_promo_daily|每日优惠指标汇总表|
|DWS 层|dws_customer_service_promo_activity|活动指标汇总表|
|ADS 层|ads_customer_service_promo_overview|优惠活动效果总览表（分层 / 不分层）|
|ADS 层|ads_customer_service_promo_trend|优惠活动时间趋势表|
|ADS 层|ads_customer_service_promo_activity_effect|活动效果分析表（分层 / 不分层）|
|ADS 层|ads_customer_service_performance|客服绩效分析表（分层 / 不分层）|

## 三、详细表结构设计

### （一）ODS 层（操作数据存储层）

#### 1. ods_customer_service_promo_activity（客服优惠活动表）

- **业务含义**：存储客服专属优惠活动的基础信息，记录活动创建、生效、结束的全生命周期数据。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |activity_id|string|32|活动唯一标识|主键，全局唯一|act_20250801_001|
  |activity_name|string|64|活动名称|非空，描述活动主题|"618 客服专属满减活动"|
  |activity_level|string|16|活动级别（商品级 / SKU 级）|枚举值："product_level"、"sku_level"|"product_level"|
  |promo_type|string|16|优惠类型（固定 / 自定义）|枚举值："fixed"、"custom"|"custom"|
  |custom_promo_max|decimal(10,2)|-|自定义优惠金额上限|promo_type 为 "custom" 时非空，≤5000 元|200.00|
  |start_time|datetime|-|活动开始时间|非空，格式：yyyy-MM-dd HH:mm:ss|2025-06-01 00:00:00|
  |end_time|datetime|-|活动结束时间|非空，晚于 start_time，活动时长 2-120 天|2025-06-20 23:59:59|
  |status|string|16|活动状态|枚举值："draft"、"published"、"ended"|"published"|
  |shop_id|string|32|活动所属店铺 ID|非空，关联店铺表|shop_001|
  |create_time|datetime|-|活动创建时间|非空，早于 start_time 1-7 天|2025-05-28 14:30:00|
  |raw_extra|string|512|原始业务系统扩展字段|JSON 格式，存储创建人、审批状态等|{"creator":"admin","audit":"pass"}|


#### 2. ods_customer_service_promo_activity_item（活动 - 商品关联表）

- **业务含义**：记录活动与商品 / SKU 的关联关系，明确活动覆盖的商品范围及优惠规则。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |id|string|32|关联记录唯一 ID|主键，全局唯一|act_item_001|
  |activity_id|string|32|关联活动 ID|外键，关联 ods_customer_service_promo_activity|act_20250801_001|
  |product_id|string|32|商品 ID|非空，活动级别为 product_level 时必填|prod_001|
  |sku_id|string|32|SKU ID|活动级别为 sku_level 时必填|sku_001_red|
  |promo_amount|decimal(10,2)|-|商品 /sku 优惠金额|非空，≤5000 元|50.00|
  |limit_purchase_count|int|-|限购数量|非空，≥1|2|
  |is_removed|tinyint|1|是否移除关联|枚举值：0（有效）、1（已移除）|0|
  |create_time|datetime|-|关联创建时间|非空|2025-05-28 15:00:00|


#### 3. ods_customer_service_promo_send（优惠发送表）

- **业务含义**：记录客服向用户发送专属优惠的行为数据，包括发送时间、金额、接收用户等信息。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |send_id|string|32|发送记录唯一 ID|主键，全局唯一|send_001|
  |activity_id|string|32|关联活动 ID|外键，关联活动表|act_20250801_001|
  |product_id|string|32|商品 ID|非空，对应活动关联的商品|prod_001|
  |sku_id|string|32|SKU ID|活动级别为 sku_level 时必填|sku_001_red|
  |customer_service_id|string|32|发送客服 ID|非空，关联客服表|cs_001|
  |consumer_id|string|32|接收用户 ID|非空|user_001|
  |actual_promo_amount|decimal(10,2)|-|实际优惠金额|非空，≤5000 元，≤活动 custom_promo_max|40.00|
  |valid_duration|int|-|优惠有效期（小时）|非空，1-24 小时|24|
  |send_time|datetime|-|发送时间|非空，在活动 start_time 和 end_time 之间|2025-06-01 10:30:00|
  |remark|string|255|发送备注|可空，如 "新客首单优惠"|"新客专享"|


#### 4. ods_customer_service_promo_use（优惠核销表）

- **业务含义**：记录用户使用客服专属优惠的交易数据，包括支付时间、金额、购买数量等。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |use_id|string|32|核销记录唯一 ID|主键，全局唯一|use_001|
  |send_id|string|32|关联发送记录 ID|外键，关联发送表|send_001|
  |order_id|string|32|订单 ID|非空，唯一标识交易|order_001|
  |pay_time|datetime|-|支付时间|非空，需在优惠有效期内（send_time+valid_duration）|2025-06-01 11:45:00|
  |pay_amount|decimal(10,2)|-|实际支付金额（优惠后）|非空，≥0|160.00|
  |purchase_count|int|-|购买数量|非空，≥1，≤限购数量|2|
  |is_valid_use|tinyint|1|是否有效核销|枚举值：0（有效）、1（无效，如超时）|0|


#### 5. ods_customer_service（客服信息表）

- **业务含义**：存储客服基础信息，包括所属店铺、姓名等，为客服绩效分析提供维度数据。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |customer_service_id|string|32|客服唯一 ID|主键，全局唯一|cs_001|
  |cs_name|string|64|客服姓名|非空，可能包含特殊字符|"客服 - 小明"|
  |shop_id|string|32|所属店铺 ID|非空，关联店铺表|shop_001|
  |raw_extra|string|512|扩展字段|JSON 格式，存储入职时间、部门等|{"dept":"客服一部","hire_date":"2024-01-01"}|


#### 6. ods_product（商品信息表）

- **业务含义**：存储商品基础信息，包括名称、价格、状态等，为商品维度分析提供数据。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |product_id|string|32|商品唯一 ID|主键，全局唯一|prod_001|
  |product_name|string|128|商品名称|非空|"夏季纯棉 T 恤"|
  |price|decimal(10,2)|-|商品原价|非空，≥0|100.00|
  |shop_id|string|32|所属店铺 ID|非空，关联店铺表|shop_001|
  |status|string|16|商品状态|枚举值："在售"、"下架"|"在售"|
  |raw_extra|string|512|扩展字段|JSON 格式，存储分类、品牌等|{"category":"服饰","brand":"XX 品牌"}|


#### 7. ods_sku（SKU 信息表）

- **业务含义**：存储商品 SKU 的详细信息，包括规格、单价等，支撑精细化商品分析。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |sku_id|string|32|SKU 唯一 ID|主键，全局唯一|sku_001_red|
  |product_id|string|32|关联商品 ID|外键，关联商品表|prod_001|
  |spec|string|64|SKU 规格（颜色、尺寸等）|非空|"红色 - M 码"|
  |sku_price|decimal(10,2)|-|SKU 单价|非空，≥0|105.00|
  |raw_extra|string|512|扩展字段|JSON 格式，存储库存、批次等|{"stock":500,"batch":"202505"}|


### （二）DIM 层（维度层）

#### 1. dim_activity_type（活动类型维度表）

- **业务含义**：标准化活动类型维度，统一活动级别和优惠类型的编码与描述。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |type_code|string|32|类型编码|主键，全局唯一|"activity_level_product"|
  |type_name|string|64|类型名称|非空|"商品级活动"|
  |type_category|string|16|类型分类|枚举值："activity_level"、"promo_type"|"activity_level"|
  |description|string|255|类型描述|可空|"活动覆盖整个商品，不区分 SKU"|
  |etl_update_time|datetime|-|ETL 更新时间|非空，记录维度表更新时间|2025-08-01 00:00:00|


#### 2. dim_customer_service（客服维度表）

- **业务含义**：对 ODS 层客服信息进行清洗标准化，生成可直接用于分析的客服维度数据。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |customer_service_id|string|32|客服唯一 ID|主键，与 ODS 层一致|cs_001|
  |cs_name|string|64|清洗后客服姓名|非空，去除特殊字符|"客服小明"|
  |shop_id|string|32|所属店铺 ID|非空，关联 dim_shop|shop_001|
  |etl_update_time|datetime|-|ETL 更新时间|非空|2025-08-01 00:00:00|


#### 3. dim_product（商品维度表）

- **业务含义**：对 ODS 层商品信息进行清洗标准化，统一商品状态等枚举值。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |product_id|string|32|商品唯一 ID|主键，与 ODS 层一致|prod_001|
  |product_name|string|128|商品名称|非空，标准化格式|"夏季纯棉 T 恤"|
  |price|decimal(10,2)|-|商品原价|非空，与 ODS 层一致|100.00|
  |shop_id|string|32|所属店铺 ID|非空，关联 dim_shop|shop_001|
  |status|string|16|标准化状态|枚举值："onsale"（在售）、"offsale"（下架）|"onsale"|
  |etl_update_time|datetime|-|ETL 更新时间|非空|2025-08-01 00:00:00|


#### 4. dim_sku（SKU 维度表）

- **业务含义**：对 ODS 层 SKU 信息进行清洗，关联商品维度补充信息。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |sku_id|string|32|SKU 唯一 ID|主键，与 ODS 层一致|sku_001_red|
  |product_id|string|32|关联商品 ID|外键，关联 dim_product|prod_001|
  |product_name|string|128|商品名称（关联补充）|非空，取自 dim_product|"夏季纯棉 T 恤"|
  |spec|string|64|SKU 规格|非空，与 ODS 层一致|"红色 - M 码"|
  |sku_price|decimal(10,2)|-|SKU 单价|非空，与 ODS 层一致|105.00|
  |etl_update_time|datetime|-|ETL 更新时间|非空|2025-08-01 00:00:00|


#### 5. dim_shop（店铺维度表）

- **业务含义**：标准化店铺信息，补充平台属性，支撑店铺维度分析。
- **字段说明**：

  |字段名|类型|长度|字段含义|业务约束|示例值|
      |---|---|---|---|---|---|
  |shop_id|string|32|店铺唯一 ID|主键，与 ODS 层一致|shop_001|
  |shop_name|string|64|店铺名称|非空|"XX 官方旗舰店"|
  |platform|string|16|所属平台|枚举值："taobao"、"tmall"、"jd"、"unknown"|"tmall"|
  |etl_update_time|datetime|-|ETL 更新时间|非空|2025-08-01 00:00:00|


### （三）DWD 层（明细数据层）

#### 1. dwd_customer_service_promo_activity（活动明细事实表）

- **业务含义**：对 ODS 层活动表进行清洗转换，标准化状态和时间格式，关联店铺维度补充信息。
- **字段说明**：

  |字段名|类型|长度|字段含义|处理逻辑|示例值|
      |---|---|---|---|---|---|
  |activity_id|string|32|活动唯一标识|同 ODS 层|act_20250801_001|
  |activity_name|string|64|活动名称|同 ODS 层|"618 客服专属满减活动"|
  |activity_level|string|16|标准化活动级别|关联 dim_activity_type 转换|"product_level"|
  |promo_type|string|16|标准化优惠类型|关联 dim_activity_type 转换|"custom"|
  |custom_promo_max|decimal(10,2)|-|自定义优惠上限|同 ODS 层|200.00|
  |start_time|timestamp|-|活动开始时间|转换为 timestamp 类型|2025-06-01 00:00:00|
  |end_time|timestamp|-|活动结束时间|转换为 timestamp 类型|2025-06-20 23:59:59|
  |status|string|16|标准化状态|"草稿"→"draft"；"已发布"→"published"|"published"|
  |shop_id|string|32|店铺 ID|同 ODS 层|shop_001|
  |shop_name|string|64|店铺名称（关联补充）|关联 dim_shop 补充|"XX 官方旗舰店"|
  |create_time|timestamp|-|活动创建时间|转换为 timestamp 类型|2025-05-28 14:30:00|
  |etl_load_time|timestamp|-|ETL 加载时间|系统当前时间|2025-08-01 01:00:00|


#### 2. dwd_customer_service_promo_send（优惠发送明细事实表）

- **业务含义**：对 ODS 层发送表进行清洗，补充商品、客服维度信息，计算优惠过期时间。
- **字段说明**：

  |字段名|类型|长度|字段含义|处理逻辑|示例值|
      |---|---|---|---|---|---|
  |send_id|string|32|发送记录 ID|同 ODS 层|send_001|
  |activity_id|string|32|活动 ID|同 ODS 层|act_20250801_001|
  |product_id|string|32|商品 ID|同 ODS 层|prod_001|
  |product_name|string|128|商品名称（关联补充）|关联 dim_product 补充|"夏季纯棉 T 恤"|
  |sku_id|string|32|SKU ID|同 ODS 层|sku_001_red|
  |sku_spec|string|64|SKU 规格（关联补充）|关联 dim_sku 补充|"红色 - M 码"|
  |customer_service_id|string|32|客服 ID|同 ODS 层|cs_001|
  |cs_name|string|64|客服姓名（关联补充）|关联 dim_customer_service 补充|"客服小明"|
  |consumer_id|string|32|用户 ID|同 ODS 层|user_001|
  |actual_promo_amount|decimal(10,2)|-|实际优惠金额|同 ODS 层|40.00|
  |valid_duration|int|-|有效期（小时）|超出 24 小时则截断为 24|24|
  |send_time|timestamp|-|发送时间|转换为 timestamp 类型|2025-06-01 10:30:00|
  |expire_time|timestamp|-|过期时间（计算字段）|send_time + valid_duration 小时|2025-06-02 10:30:00|
  |is_expired|boolean|-|是否过期（计算字段）|系统时间 > expire_time → true|false|
  |remark|string|255|发送备注|同 ODS 层|"新客专享"|
  |etl_load_time|timestamp|-|ETL 加载时间|系统当前时间|2025-08-01 01:00:00|


#### 3. dwd_customer_service_promo_use（优惠核销明细事实表）

- **业务含义**：对 ODS 层核销表进行清洗，关联发送表补充活动、商品信息，标记核销有效性。
- **字段说明**：

  |字段名|类型|长度|字段含义|处理逻辑|示例值|
      |---|---|---|---|---|---|
  |use_id|string|32|核销记录 ID|同 ODS 层|use_001|
  |send_id|string|32|关联发送 ID|同 ODS 层|send_001|
  |activity_id|string|32|关联活动 ID（补充）|关联 dwd_customer_service_promo_send 补充|act_20250801_001|
  |product_id|string|32|商品 ID（补充）|关联发送表明细补充|prod_001|
  |consumer_id|string|32|用户 ID（补充）|关联发送表明细补充|user_001|
  |order_id|string|32|订单 ID|同 ODS 层|order_001|
  |pay_time|timestamp|-|支付时间|转换为 timestamp 类型|2025-06-01 11:45:00|
  |pay_amount|decimal(10,2)|-|支付金额|同 ODS 层|160.00|
  |purchase_count|int|-|购买数量|同 ODS 层|2|
  |is_valid_use|boolean|-|是否有效核销|ODS 层 is_valid_use=0 → true|true|
  |etl_load_time|timestamp|-|ETL 加载时间|系统当前时间|2025-08-01 01:00:00|


### （四）DWS 层（汇总数据层）

#### 1. dws_customer_rfm（用户 RFM 指标汇总表）

- **业务含义**：基于核销明细数据计算用户 RFM 指标（最近消费、消费频率、消费金额），并进行打分和分层。
- **字段说明**：

  |字段名|类型|长度|字段含义|计算逻辑|示例值|
      |---|---|---|---|---|---|
  |consumer_id|string|32|用户 ID|分组维度|user_001|
  |R|int|-|最近消费距今天数|datediff(current_date(), max(pay_time))|3|
  |F|int|-|消费频率（核销次数）|count(use_id)|5|
  |M|decimal(10,2)|-|消费总金额|sum(pay_amount)|800.00|
  |R_score|int|-|R 维度得分（1-5 分）|R≤7→5；7<R≤30→4；30<R≤90→3；90<R≤180→2；R>180→1|5|
  |F_score|int|-|F 维度得分（1-5 分）|F≥10→5；5≤F<10→4；3≤F<5→3；1≤F<3→2；F=0→1|4|
  |M_score|int|-|M 维度得分（1-5 分）|M≥1000→5；500≤M<1000→4；300≤M<500→3；100≤M<300→2；M<100→1|3|
  |rfm_total|int|-|RFM 总分|R_score + F_score + M_score|12|
  |user_level|string|16|用户分层|rfm_total>12→"高价值"；8<≤12→"潜力"；5<≤8→"一般"；≤5→"流失"|"潜力用户"|
  |etl_update_time|timestamp|-|ETL 更新时间|系统当前时间|2025-08-01 02:00:00|


#### 2. dws_customer_service_promo_daily（每日优惠指标汇总表）

- **业务含义**：按日汇总优惠发送和核销指标，支撑时间趋势分析。
- **字段说明**：

  |字段名|类型|长度|字段含义|计算逻辑|示例值|
      |---|---|---|---|---|---|
  |stat_date|date|-|统计日期|分组维度（send_time 的日期）|2025-06-01|
  |shop_id|string|32|店铺 ID|分组维度|shop_001|
  |platform|string|16|平台（补充）|关联 dim_shop 补充|"tmall"|
  |total_send_count|int|-|当日发送次数|count(distinct send_id)|100|
  |total_use_count|int|-|当日核销次数|count(distinct use_id)|30|
  |valid_use_count|int|-|当日有效核销次数|sum(case when is_valid_use then 1 else 0 end)|28|
  |use_rate|decimal(5,2)|-|当日核销率（%）|valid_use_count / total_send_count * 100|28.00|
  |etl_update_time|timestamp|-|ETL 更新时间|系统当前时间|2025-08-01 02:00:00|


#### 3. dws_customer_service_promo_activity（活动指标汇总表）

- **业务含义**：按活动汇总发送和核销指标，支撑活动效果评估。
- **字段说明**：

  |字段名|类型|长度|字段含义|计算逻辑|示例值|
      |---|---|---|---|---|---|
  |activity_id|string|32|活动 ID|分组维度|act_20250801_001|
  |activity_name|string|64|活动名称|关联活动明细补充|"618 客服专属满减活动"|
  |activity_level|string|16|活动级别|关联活动明细补充|"product_level"|
  |promo_type|string|16|优惠类型|关联活动明细补充|"custom"|
  |total_send_count|int|-|活动总发送次数|count(distinct send_id)|500|
  |total_use_count|int|-|活动总核销次数|count(distinct use_id)|150|
  |7d_send_count|int|-|近 7 天发送次数|筛选近 7 天 send_time 的 send_id 计数|50|
  |7d_use_count|int|-|近 7 天核销次数|筛选近 7 天 pay_time 的 use_id 计数|15|
  |use_rate|decimal(5,2)|-|活动核销率（%）|total_use_count / total_send_count * 100|30.00|
  |etl_update_time|timestamp|-|ETL 更新时间|系统当前时间|2025-08-01 02:00:00|


### （五）ADS 层（应用数据层）

#### 1. ads_customer_service_promo_overview（优惠活动效果总览表）

- **业务含义**：按用户分层和时间周期汇总优惠活动核心指标，支撑宏观效果分析。
- **字段说明**：

  |字段名|类型|长度|字段含义|维度说明|示例值|
      |---|---|---|---|---|---|
  |stat_period|string|16|统计周期|枚举值："day"、"7days"、"30days"、"all"|"all"|
  |period_value|string|32|周期值|如 "2025-06-01"、"2025-06"|"2025-06"|
  |user_level|string|16|用户分层|枚举值："all"、"高价值用户"、"潜力用户" 等|"all"|
  |total_send_count|int|-|总发送次数|-|1000|
  |total_use_count|int|-|总核销次数|-|300|
  |valid_use_count|int|-|有效核销次数|-|280|
  |use_rate|decimal(5,2)|-|核销率（%）|valid_use_count / total_send_count * 100|28.00|
  |total_promo_amount|decimal(10,2)|-|总优惠金额|sum(actual_promo_amount)|40000.00|
  |total_pay_amount|decimal(10,2)|-|总支付金额|sum(pay_amount)|160000.00|
  |etl_time|timestamp|-|ETL 计算时间|系统当前时间|2025-08-01 03:00:00|


#### 2. ads_customer_service_promo_trend（优惠活动时间趋势表）

- **业务含义**：按时间周期（日 / 周 / 月）展示优惠活动指标趋势，支撑趋势分析。
- **字段说明**：

  |字段名|类型|长度|字段含义|维度说明|示例值|
      |---|---|---|---|---|---|
  |stat_date|date|-|统计日期 / 周 / 月|按周期粒度聚合|2025-06-01|
  |period_type|string|16|周期类型|枚举值："day"、"week"、"month"|"day"|
  |send_count|int|-|周期发送次数|-|100|
  |use_count|int|-|周期核销次数|-|30|
  |pay_amount|decimal(10,2)|-|周期支付金额|-|16000.00|
  |use_rate|decimal(5,2)|-|周期核销率（%）|-|30.00|
  |etl_time|timestamp|-|ETL 计算时间|系统当前时间|2025-08-01 03:00:00|


#### 3. ads_customer_service_promo_activity_effect（活动效果分析表）

- **业务含义**：按活动和用户分层展示活动效果指标，支撑活动效果对比。
- **字段说明**：

  |字段名|类型|长度|字段含义|维度说明|示例值|
      |---|---|---|---|---|---|
  |activity_id|string|32|活动 ID|分组维度|act_20250801_001|
  |activity_name|string|64|活动名称|-|"618 客服专属满减活动"|
  |activity_level|string|16|活动级别|-|"product_level"|
  |promo_type|string|16|优惠类型|-|"custom"|
  |user_level|string|16|用户分层|枚举值："all"、"高价值用户" 等|"all"|
  |send_count|int|-|活动发送次数|-|500|
  |use_count|int|-|活动核销次数|-|150|
  |use_rate|decimal(5,2)|-|活动核销率（%）|-|30.00|
  |total_pay_amount|decimal(10,2)|-|活动总支付金额|-|80000.00|
  |rank|int|-|活动效果排名|按 use_rate 降序排序|1|
  |etl_time|timestamp|-|ETL 计算时间|系统当前时间|2025-08-01 03:00:00|


#### 4. ads_customer_service_performance（客服绩效分析表）

- **业务含义**：按客服和用户分层展示绩效指标，支撑客服绩效评估。
- **字段说明**：

  |字段名|类型|长度|字段含义|维度说明|示例值|
      |---|---|---|---|---|---|
  |customer_service_id|string|32|客服 ID|分组维度|cs_001|
  |cs_name|string|64|客服姓名|-|"客服小明"|
  |shop_id|string|32|所属店铺 ID|-|shop_001|
  |user_level|string|16|用户分层|枚举值："all"、"高价值用户" 等|"all"|
  |send_count|int|-|发送次数|-|200|
  |use_count|int|-|核销次数|-|60|
  |use_rate|decimal(5,2)|-|核销率（%）|-|30.00|
  |avg_promo_amount|decimal(10,2)|-|平均优惠金额|total_promo_amount / send_count|40.00|
  |total_pay_amount|decimal(10,2)|-|总支付金额|-|32000.00|
  |etl_time|timestamp|-|ETL 计算时间|系统当前时间|2025-08-01 03:00:00|


## 四、表间关系说明

### 4.1 核心关联键

|关联键|关联表范围|说明|
|---|---|---|
|activity_id|ODS 活动表 ↔ 活动 - 商品关联表 ↔ 发送表 ↔ 核销表 ↔ DWD/DWS/ADS 层活动相关表|贯穿活动全生命周期的唯一标识|
|send_id|发送表 ↔ 核销表 ↔ DWD/DWS/ADS 层发送 / 核销相关表|关联优惠发送与核销行为|
|product_id|商品表 ↔ SKU 表 ↔ 活动 - 商品关联表 ↔ 发送表|关联商品与相关业务表|
|customer_service_id|客服表 ↔ 发送表 ↔ DWD/DWS/ADS 层客服相关表|关联客服与绩效指标|
|consumer_id|发送表 ↔ 核销表 ↔ RFM 表 ↔ ADS 层分层指标表|关联用户与分层、消费指标|
|shop_id|店铺维度表 ↔ 活动表 / 商品表 / 客服表|关联店铺与所属业务实体|

### 4.2 层级依赖关系

- **ODS 层 → DIM 层**：DIM 层基于 ODS 层原始数据进行清洗标准化（如客服姓名去特殊字符、商品状态枚举转换）；
- **ODS 层 + DIM 层 → DWD 层**：DWD 层通过关联 ODS 层事实数据和 DIM 层维度数据，补充业务描述信息（如发送表关联商品维度补充商品名称）；
- **DWD 层 → DWS 层**：DWS 层对 DWD 层明细数据按主题（用户、活动、日期）汇总，生成中间指标（如 RFM 值、每日发送量）；
- **DWS 层 → ADS 层**：ADS 层基于 DWS 层汇总指标，按业务场景（总览、趋势、活动效果、绩效）重组数据，输出直接可用的业务指标。

## 五、核心业务指标计算逻辑

|指标名称|计算逻辑公式|数据来源表|
|---|---|---|
|核销率|有效核销次数 / 总发送次数 × 100%|dwd_customer_service_promo_send、dwd_customer_service_promo_use|
|R 值（最近消费）|当前日期 - 最近一次支付时间（天）|dwd_customer_service_promo_use|
|F 值（消费频率）|用户核销次数总和|dwd_customer_service_promo_use|
|M 值（消费金额）|用户支付金额总和|dwd_customer_service_promo_use|
|RFM 总分|R_score + F_score + M_score|dws_customer_rfm|
|活动排名|按活动核销率降序排序|dws_customer_service_promo_activity|
|客服平均优惠金额|客服发送的总优惠金额 / 发送次数|dwd_customer_service_promo_send|

## 六、附录

### 6.1 术语表

|术语|定义说明|
|---|---|
|RFM 模型|基于最近消费（Recency）、消费频率（Frequency）、消费金额（Monetary）的用户分层模型|
|SKU|库存保有单位，指商品的具体规格（如红色 - M 码 T 恤）|
|核销率|优惠被有效使用的比例，反映优惠的转化效果|
|有效核销|在优惠有效期内完成的支付行为|

### 6.2 业务约束汇总

1. 优惠金额：所有场景下优惠金额≤5000 元，且为整数；
2. 活动时长：活动开始到结束时间间隔为 2-120 天；
3. 优惠有效期：发送后 1-24 小时内有效；
4. 限购数量：单个商品 / SKU 的限购次数≥1；
5. RFM 分层：基于 3 个维度得分总和（3-15 分），分为 4 个用户层级。